// app.js
/* --------- [ IMPORTACOES ] ---------- */
import { config } from 'dotenv';
config();
import express from 'express';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';
import { rateLimit } from './【 MODULES 】/libs.js'; // só rateLimit do libs
import { PATHS } from './config.js';
import { errorHandler } from './【 MIDDLEWARE 】/errorHandler.js';

/* --------- [ ROUTERS PESQUISAS ] ---------- */
import animetvRouter from './【 ROUTES 】/pesquisa/animetv.js';

import appleMusicRouter from './【 ROUTES 】/pesquisa/appleMusic.js';

import amazonRouter from './【 ROUTES 】/pesquisa/amazon.js';

import animeRouter from './【 ROUTES 】/pesquisa/anime.js';

import aptoideRoute from './【 ROUTES 】/pesquisa/aptoide.js';

import brasileiraoRouter from './【 ROUTES 】/pesquisa/brasileirao.js';

import cinemaRouter from './【 ROUTES 】/pesquisa/cinema.js';

import celularRouter from './【 ROUTES 】/pesquisa/celular.js';

import cepRouter from './【 ROUTES 】/pesquisa/cep.js';

import climaRouter from './【 ROUTES 】/pesquisa/clima.js';

import dddRouter from './【 ROUTES 】/pesquisa/ddd.js';

import dicionarioRouter from './【 ROUTES 】/pesquisa/dicionario.js';

import estadaoRouter from './【 ROUTES 】/pesquisa/estadao.js';

import emojiRouter from './【 ROUTES 】/pesquisa/emoji.js';

import gimageRouter from './【 ROUTES 】/pesquisa/gimage.js';

import globoRouter from './【 ROUTES 】/pesquisa/globo.js';

import gameNewsRouter from './【 ROUTES 】/pesquisa/game-news.js';

import instagramVideoInfoRouter from './【 ROUTES 】/pesquisa/instagramVideoInfo.js';

import imdbInfoRouter from './【 ROUTES 】/pesquisa/imdbinfo.js';

import imdbRouter from './【 ROUTES 】/pesquisa/imdb.js';

import jovempanRouter from './【 ROUTES 】/pesquisa/jovempan.js';

import kwaiRouter from './【 ROUTES 】/pesquisa/kwai.js';

import lyricsRouter from './【 ROUTES 】/pesquisa/lyrics.js';

import mercadoLivreRoute from './【 ROUTES 】/pesquisa/mercadolivre.js';

import metadinhasRouter from './【 ROUTES 】/pesquisa/metadinhas.js';

import movieRouter from './【 ROUTES 】/pesquisa/movie.js';

import myInstantsRouter from './【 ROUTES 】/pesquisa/myinstants.js';

import nameInfoRouter from './【 ROUTES 】/pesquisa/nameInfo.js';

import noticiasRouter from './【 ROUTES 】/pesquisa/noticias.js';

import npmRouter from './【 ROUTES 】/pesquisa/npm.js';

import nhentaiRouter from './【 ROUTES 】/pesquisa/nhentai.js';

import nasaRoute from './【 ROUTES 】/pesquisa/nasa.js';

import printsiteRouter from './【 ROUTES 】/pesquisa/printsite.js';

import playstoreRouter from './【 ROUTES 】/pesquisa/playstore.js';

import pinterestRouter from './【 ROUTES 】/pesquisa/pinterest.js';

import pornhubRouter from './【 ROUTES 】/pesquisa/pornhub.js';

import poder360Router from './【 ROUTES 】/pesquisa/poder360.js';

import pensadorRouter from './【 ROUTES 】/pesquisa/pensador.js';

import receitaRouter from './【 ROUTES 】/pesquisa/receita.js';

import sportsRouter from './【 ROUTES 】/pesquisa/sports.js';

import soundcloudFullRouter from './【 ROUTES 】/pesquisa/soundcloudsearch.js';

import serieRouter from './【 ROUTES 】/pesquisa/serie.js';

import soundcloudRouter from './【 ROUTES 】/pesquisa/soundcloud.js';

import signoRouter from './【 ROUTES 】/pesquisa/signo.js';

import translatorRouter from './【 ROUTES 】/pesquisa/translator.js';

import tunaRouter from './【 ROUTES 】/pesquisa/tuna.js';

import tiktokRouter from './【 ROUTES 】/pesquisa/tiktok.js';

import threadsRouter from './【 ROUTES 】/pesquisa/threads.js';

import tekmodsRouter from './【 ROUTES 】/pesquisa/tekmods.js';

import uolRouter from './【 ROUTES 】/pesquisa/uol.js';

import whatsappGroupsRouter from './【 ROUTES 】/pesquisa/whatsapp-groups.js';

import wikipediaRouter from './【 ROUTES 】/pesquisa/wikipedia.js';

import wallpaperRouter from './【 ROUTES 】/pesquisa/wallpaper.js';

import xvideosRouter from './【 ROUTES 】/pesquisa/xvideos.js';

import youtubeRouter from './【 ROUTES 】/pesquisa/youtube.js';

import ytsearchRouter from './【 ROUTES 】/pesquisa/ytsearch.js';

/* --------- [ ROUTERS FIGURINHAS ] ---------- */
import emojimixRouter from './【 ROUTES 】/figurinhas/emojimix.js';

import stickersRouter from './【 ROUTES 】/figurinhas/stickers.js';

/* --------- [ ROUTERS DOWNLOADS ] ---------- */
import facebookDownloadRouter from './【 ROUTES 】/downloads/facebookDownload.js';

// instagramVideoInfoRouter tambem esta aqui pq faz download tambem

// soundcloudRouter tambem é aqui

import playvideoRouter from './【 ROUTES 】/downloads/playvideo.js';

import pinterestMp4Router from './【 ROUTES 】/downloads/pinterestMp4.js';

import tiktokDownloadRouter from './【 ROUTES 】/downloads/tiktokDownload.js';

// threads tambem é aqui 

import twitterDownloadRouter from './【 ROUTES 】/downloads/twitterDownload.js';

/* --------- [ ROUTERS INTELIGENCIA ARTIFICIAL ] ---------- */
import gptRouter from './【 ROUTES 】/ias/gpt.js';

/* --------- [ ROUTERS STALKS ] ---------- */
import instagramStalkerRouter from './【 ROUTES 】/stalks/instagramstalker.js';

import tiktokStalkerRouter from './【 ROUTES 】/stalks/tiktokstalker.js';

/* --------- [ ROUTERS BANNER ] ---------- */
import levelupRouter from './【 ROUTES 】/banner/levelup.js';

import shipRouter from './【 ROUTES 】/banner/ship.js';

// nameInfoRouter tambem é banner

/* --------- [ ROUTERS FERRAMENTAS ] ---------- */
import nickgenRouter from './【 ROUTES 】/ferramentas/nickgen.js';

/* --------- [ CONFIGURACOES ] ---------- */
const app = express();

app.set('trust proxy', 1);

app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true }));

/* --------- [ RATE LIMIT ] ---------- */
const limiter = rateLimit({
  windowMs: 60 * 1000, // 1 minuto
  max: 30, // 30 requisições por minuto
  message: {
    error: 'Limite de requisições excedido. Tente novamente em 1 minuto.'
  }
});
app.use('/api', limiter);

/* --------- [ PAGINA INICIAL ] ---------- */
app.get('/', (req, res) => {
  res.sendFile(PATHS.pagina_inicial);
});

/* --------- [ ROTA PARA A DOCUMENTACAO ] ---------- */
app.get('/docs', (req, res) => {
  res.sendFile(PATHS.docs);
});

/* --------- [ SERVIR ARQUIVOS ESTATICOS ] ---------- */
app.use(express.static(PATHS.arquivos_estaticos));
app.use('/downloads', express.static(PATHS.downloadsDir));

/* --------- [ ROUTERS PESQUISAS ] ---------- */

app.use('/api/animetv', animetvRouter);

app.use('/api/game-news', gameNewsRouter);

app.use('/api/sports', sportsRouter);

app.use('/api/printsite', printsiteRouter);

app.use('/api/soundcloud', soundcloudRouter);

app.use('/api/instagram', instagramVideoInfoRouter);

app.use('/api/name', nameInfoRouter);

app.use('/api/nasa', nasaRoute);

app.use('/api/amazon', amazonRouter);

app.use('/api/signo', signoRouter);

app.use('/api/playstore', playstoreRouter);

app.use('/api/imdb', imdbRouter);

app.use('/api/imdbinfo', imdbInfoRouter);

app.use('/api/pinterest', pinterestRouter);

app.use('/api/globo', globoRouter);

app.use('/api/tekmods', tekmodsRouter);

app.use('/api/nhentai', nhentaiRouter);

app.use('/api/emoji', emojiRouter);

app.use('/api/anime', animeRouter);

app.use('/api/youtube', youtubeRouter);

app.use('/api/cep', cepRouter);

app.use('/api/poder360', poder360Router);

app.use('/api/jovempan', jovempanRouter);

app.use('/api/uol', uolRouter);

app.use('/api/ddd', dddRouter);

app.use('/api/npm', npmRouter);

app.use('/api/translator', translatorRouter);

app.use('/api/estadao', estadaoRouter);

app.use('/api/cinema', cinemaRouter);

app.use('/api/clima', climaRouter);

app.use('/api/kwai', kwaiRouter);

app.use('/api/aptoide', aptoideRoute);

app.use('/api/receita', receitaRouter);

app.use('/api/serie', serieRouter);

app.use('/api/brasileirao', brasileiraoRouter);

app.use('/api/tiktok', tiktokRouter);

app.use('/api/lyrics', lyricsRouter);

app.use('/api/wikipedia', wikipediaRouter);

app.use('/api/mercadolivre', mercadoLivreRoute);

app.use('/api/pornhub', pornhubRouter);

app.use('/api/soundcloudsearch', soundcloudFullRouter); // mesmo router que /soundcloud

app.use('/api/celular', celularRouter);

app.use('/api/whatsapp-groups', whatsappGroupsRouter);

app.use('/api/ytsearch', ytsearchRouter);

app.use('/api/gimage', gimageRouter);

app.use('/api/xvideos', xvideosRouter);

app.use('/api/noticias', noticiasRouter);

app.use('/api/pensador', pensadorRouter);

app.use('/api/movie', movieRouter);

app.use('/api/applemusic', appleMusicRouter);

app.use('/api/dicionario', dicionarioRouter);

app.use('/api/tuna', tunaRouter);

app.use('/api/wallpaper', wallpaperRouter);

/* --------- [ ROUTERS FIGURINHAS ] ---------- */
app.use('/api/figurinhas', stickersRouter);

app.use('/api/emojimix', emojimixRouter);

/* --------- [ ROUTERS DOWNLOADS ] ---------- */
app.use('/api/tiktok/download', tiktokDownloadRouter);

app.use('/api/instagram/story', instagramVideoInfoRouter); // também faz download

app.use('/api/playvideo', playvideoRouter);
app.use('/api/pinterestMp4', pinterestMp4Router);


app.use('/api/threads', threadsRouter); // threads também faz download
app.use('/api/twitter/download', twitterDownloadRouter);

app.use('/api/facebook/download', facebookDownloadRouter);

/* --------- [ ROUTERS INTELIGENCIA ARTIFICIAL ] ---------- */
app.use('/api/gpt', gptRouter); // (não estava na lista, mas existe o import)

/* --------- [ ROUTERS STALKS ] ---------- */
app.use('/api/instagramstalker', instagramStalkerRouter);

app.use('/api/tiktokstalker', tiktokStalkerRouter);

/* --------- [ ROUTERS BANNER ] ---------- */
app.use('/api/levelup', levelupRouter);

app.use('/api/ship', shipRouter);

app.use('/api/metadinhas', metadinhasRouter);

// nameInfoRouter também é usado como banner em alguns casos
// (já está em PESQUISAS, mas pode ser usado como banner)

/* --------- [ ROUTERS FERRAMENTAS ] ---------- */
app.use('/api/nickgen', nickgenRouter);

/* --------- [ MIDDLEWARE DE ERROR GLOBAL ] ---------- */
app.use(errorHandler);

/* --------- [ MIDDLEWARE PARA ROTAS NAO ENCONTRADAS ] ---------- */
app.use((req, res) => {
  res.status(404).send(`
    <!DOCTYPE html>
    <html lang="pt-br">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>404 - Página não encontrada | MAKISE API</title>
      <!-- Google Fonts para tipografia premium -->
      <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
      <!-- Font Awesome para ícones -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
      <style>
        :root {
          --primary: #0a0a0a;
          --accent: #c00000;
          --text: #ffffff;
          --text-muted: #a0a0a0;
        }
        body { 
          font-family: 'Poppins', sans-serif;
          background: linear-gradient(135deg, var(--primary) 0%, #2c1a3d 100%); /* Gradiente futurista */
          display: flex; 
          justify-content: center; 
          align-items: center; 
          height: 100vh; 
          margin: 0;
          color: var(--text);
          overflow: hidden;
        }
        .container {
          text-align: center;
          background: rgba(21, 21, 21, 0.8); /* Fundo semi-transparente */
          padding: 60px 40px;
          border-radius: 20px;
          box-shadow: 0 0 30px rgba(192, 0, 0, 0.5); /* Glow vermelho neon */
          max-width: 500px;
          animation: fadeIn 1s ease-in-out;
          border: 1px solid var(--accent);
        }
        h1 { 
          font-size: 80px; 
          margin: 0 0 20px 0;
          color: var(--accent);
          text-shadow: 0 0 20px var(--accent); /* Efeito neon */
          animation: pulse 2s infinite;
        }
        p { 
          font-size: 18px; 
          margin: 0 0 20px 0;
          line-height: 1.5;
          color: var(--text-muted);
        }
        .illustration {
          font-size: 100px; /* Ícone grande como ilustração */
          color: var(--accent);
          margin-bottom: 20px;
          animation: float 3s infinite ease-in-out;
        }
        a.btn { 
          display: inline-block;
          padding: 14px 30px;
          font-size: 16px;
          color: var(--text); 
          background-color: var(--accent);
          border-radius: 50px;
          text-decoration: none;
          transition: all 0.3s ease;
          box-shadow: 0 0 15px rgba(192, 0, 0, 0.5);
          margin: 10px;
        }
        a.btn:hover {
          background-color: #ff0000;
          transform: scale(1.05);
          box-shadow: 0 0 25px rgba(192, 0, 0, 0.8);
        }
        .countdown {
          font-size: 14px;
          color: var(--text-muted);
          margin-top: 20px;
        }
        /* Animações */
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(20px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
          0% { text-shadow: 0 0 10px var(--accent); }
          50% { text-shadow: 0 0 30px var(--accent); }
          100% { text-shadow: 0 0 10px var(--accent); }
        }
        @keyframes float {
          0% { transform: translateY(0); }
          50% { transform: translateY(-10px); }
          100% { transform: translateY(0); }
        }
        @media (max-width: 480px) {
          h1 { font-size: 60px; }
          .container { padding: 40px 20px; }
          .illustration { font-size: 80px; }
        }
      </style>
    </head>
    <body>
      <div class="container">
        <i class="fas fa-robot illustration"></i> <!-- Ilustração: robô perdido (ícone) -->
        <h1>404</h1>
        <p>Ops! A página que você procura não existe. Talvez ela tenha sido movida ou seja um endpoint inválido na MAKISE API.</p>
        <a href="/" class="btn">Voltar ao Início</a>
        <a href="/docs" class="btn" style="background-color: #6a0dad;">Ver Documentação</a> <!-- Link extra para API docs -->
        <div class="countdown">Redirecionando para casa em <span id="timer">5</span>s...</div>
      </div>
      <script>
        // Contador de redirecionamento automático
        let time = 5;
        const timerEl = document.getElementById('timer');
        const interval = setInterval(() => {
          time--;
          timerEl.textContent = time;
          if (time <= 0) {
            clearInterval(interval);
            window.location.href = '/';
          }
        }, 1000);
      </script>
    </body>
    </html>
  `);
});

export default app;